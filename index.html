<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="What the package does (one paragraph).">
<title>What the Package Does (One Line, Title Case) • sparsepolicytree</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="What the Package Does (One Line, Title Case)">
<meta property="og:description" content="What the package does (one paragraph).">
<meta property="og:image" content="https://yale-medicaid.github.io/sparsepolicytree/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">sparsepolicytree</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header">
<img src="logo.png" class="logo" alt=""><h1 id="sparse-policy-tree-">Sparse Policy Tree <a class="anchor" aria-label="anchor" href="#sparse-policy-tree-"></a>
</h1>
</div>
<p>An R / Rust Package to implement an exhaustive tree search for policy-learning. Aims to extend and speed up work done with the <code>policytree</code> package.</p>
</div>
<div class="section level1">
<h1 id="usage">Usage<a class="anchor" aria-label="anchor" href="#usage"></a>
</h1>
<p>There’s just one function, <code><a href="reference/sparse_policy_tree.html">sparse_policy_tree()</a></code>. Use it just as you would the <code>policy_tree()</code> function from the <code>policytree</code> package.</p>
<p>Trees aren’t guaranteed to be exactly the same as those produced by <code>policytree</code> in that some leaves may be left unpruned (working on this), but they should give the same predictions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">400</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fl">4</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span><span class="va">depth</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="co"># Classification task taken from policytree tests</span></span>
<span><span class="co"># Continuous X</span></span>
<span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">n</span> <span class="op">*</span> <span class="va">p</span><span class="op">)</span>, <span class="va">n</span>, <span class="va">p</span><span class="op">)</span>,<span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">letters</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span>, <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">best.tree</span> <span class="op">&lt;-</span> <span class="fu">policytree</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/policytree/man/make_tree.html" class="external-link">make_tree</a></span><span class="op">(</span><span class="va">X</span>, depth <span class="op">=</span> <span class="va">depth</span>, d <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="va">best.action</span> <span class="op">&lt;-</span> <span class="fu">policytree</span><span class="fu">:::</span><span class="fu"><a href="https://rdrr.io/pkg/policytree/man/predict_test_tree.html" class="external-link">predict_test_tree</a></span><span class="op">(</span><span class="va">best.tree</span>, <span class="va">X</span><span class="op">)</span></span>
<span><span class="va">Y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="va">best.action</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">100</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span><span class="op">)</span></span>
<span><span class="va">best.reward</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">Y</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="va">best.action</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/sparse_policy_tree.html">sparse_policy_tree</a></span><span class="op">(</span><span class="va">X</span>,<span class="va">Y</span>,<span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree</span></span>
<span><span class="co">#&gt; policy_tree object </span></span>
<span><span class="co">#&gt; Tree depth:  2 </span></span>
<span><span class="co">#&gt; Actions:  1 2 3 </span></span>
<span><span class="co">#&gt; Variable splits: </span></span>
<span><span class="co">#&gt; (1) split_variable: b  split_value: -0.73 </span></span>
<span><span class="co">#&gt;   (2) split_variable: a  split_value: -3.36 </span></span>
<span><span class="co">#&gt;     (4) * action: 3 </span></span>
<span><span class="co">#&gt;     (5) * action: 3 </span></span>
<span><span class="co">#&gt;   (3) split_variable: a  split_value: 0.57 </span></span>
<span><span class="co">#&gt;     (6) * action: 3 </span></span>
<span><span class="co">#&gt;     (7) * action: 2</span></span></code></pre></div>
</div>
<div class="section level1">
<h1 id="installation">Installation:<a class="anchor" aria-label="anchor" href="#installation"></a>
</h1>
<div class="section level2">
<h2 id="installing-rust">Installing Rust:<a class="anchor" aria-label="anchor" href="#installing-rust"></a>
</h2>
<p>You must have <a href="https://www.rust-lang.org/tools/install" class="external-link">Rust</a> installed to compile this package. The rust website provides an excellent installation script that has never caused me any issues.</p>
<p>On Linux, you can install Rust with:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode sh"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> <span class="at">--proto</span> <span class="st">'=https'</span> <span class="at">--tlsv1.2</span> <span class="at">-sSf</span> https://sh.rustup.rs <span class="kw">|</span> <span class="fu">sh</span></span></code></pre></div>
<p>On Windows, I use the rust installation wizard, found <a href="https://forge.rust-lang.org/infra/other-installation-methods.html" class="external-link">here</a>.</p>
</div>
<div class="section level2">
<h2 id="installing-package-from-github">Installing Package from Github:<a class="anchor" aria-label="anchor" href="#installing-package-from-github"></a>
</h2>
<p>Once you install rust, you should be able to install the package with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"Yale-Medicaid/sparsepolicytree"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level1">
<h1 id="benchmarks">Benchmarks:<a class="anchor" aria-label="anchor" href="#benchmarks"></a>
</h1>
<p>Below are the results from a series of benchmarks to gauge the speed of the package. These were run on an old 4-core, 8-thread server that I have access to, and I think should be pretty representative of the speed a user can expect to see if they run the algorithm on all cores of a modern data-science laptop.</p>
<table style="width:100%;" class="table">
<colgroup>
<col width="21%">
<col width="32%">
<col width="19%">
<col width="19%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th>Number of Observations</th>
<th>Number of Distinct Predictor Values</th>
<th>Number of Predictors</th>
<th>Number of Treatments</th>
<th>Time</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>10^2</td>
<td>2</td>
<td>30</td>
<td>20</td>
<td>0.003s</td>
</tr>
<tr class="even">
<td>10^3</td>
<td>2</td>
<td>30</td>
<td>20</td>
<td>0.015s</td>
</tr>
<tr class="odd">
<td>10^4</td>
<td>2</td>
<td>30</td>
<td>20</td>
<td>0.15s</td>
</tr>
<tr class="even">
<td>10^5</td>
<td>2</td>
<td>30</td>
<td>20</td>
<td>1.57s</td>
</tr>
<tr class="odd">
<td>10^6</td>
<td>2</td>
<td>30</td>
<td>20</td>
<td>17s</td>
</tr>
<tr class="even">
<td>10^2</td>
<td>30</td>
<td>30</td>
<td>20</td>
<td>0.052s</td>
</tr>
<tr class="odd">
<td>10^3</td>
<td>30</td>
<td>30</td>
<td>20</td>
<td>0.240s</td>
</tr>
<tr class="even">
<td>10^4</td>
<td>30</td>
<td>30</td>
<td>20</td>
<td>3.041s</td>
</tr>
<tr class="odd">
<td>10^5</td>
<td>30</td>
<td>30</td>
<td>20</td>
<td>100s</td>
</tr>
<tr class="even">
<td>10^6</td>
<td>30</td>
<td>30</td>
<td>20</td>
<td>21 min</td>
</tr>
<tr class="odd">
<td>10^2</td>
<td>10^2</td>
<td>30</td>
<td>20</td>
<td>0.41s</td>
</tr>
<tr class="even">
<td>10^3</td>
<td>10^3</td>
<td>30</td>
<td>20</td>
<td>40s</td>
</tr>
<tr class="odd">
<td>10^4</td>
<td>10^4</td>
<td>30</td>
<td>20</td>
<td>70 min</td>
</tr>
</tbody>
</table>
<p>sparse_policy_tree is dominant when the number of values a variable can take is small (say, under 200), but performs poorly when the number of unique values is large. For dense variables, you are generally better off using the policytree package, which is more developed,and will return faster while running on a only single core.</p>
<div class="section level2">
<h2 id="limiting-the-number-of-threads">Limiting the Number of Threads:<a class="anchor" aria-label="anchor" href="#limiting-the-number-of-threads"></a>
</h2>
<p>To constrain the number of cores the program uses, you can set the <code>RAYON_NUM_THREADS</code> variable before running the search. At present, this variable is read at the construction of the multithreading thread pool, and so must be set once each R session. In a future version, I’ll work to include a fix so that the number of threads can be included in an argument to the <code>sparse_policy_tree</code> function.</p>
<p>Here’s an example of how to set the function to run on an single core in R:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Sys.setenv.html" class="external-link">Sys.setenv</a></span><span class="op">(</span>RAYON_NUM_THREADS<span class="op">=</span><span class="fl">1</span><span class="op">)</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small>`use_mit_license()`, `use_gpl3_license()` or friends to pick a
    license</small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing sparsepolicytree</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>First Last <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/YOUR-ORCID-ID" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
